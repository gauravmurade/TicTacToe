function initializeTableDeck(){for(var a=[],b=1,c=0;52>c;c++){var d=(c+1)%13==0?13:(c+1)%13,e="",f=CardSuite.d;switch(f=1==b?CardSuite.c:2==b?CardSuite.d:3==b?CardSuite.h:CardSuite.s,d){case 11:e="J";break;case 12:e="Q";break;case 13:e="K";break;case 1:e="A";break;default:e=d.toString()}a.push(new Card(e,f)),13==d&&b++}return a}function distributeCards(a){for(var b=0;2>b;b++)for(var c=0;c<a.playerList.length;c++)a.playerList[c].cards.push(a.deck.pop());burnCard(a.deck);for(var b=0;3>b;b++)a.closedCards.push(a.deck.pop());burnCard(a.deck),a.closedCards.push(a.deck.pop()),burnCard(a.deck),a.closedCards.push(a.deck.pop())}function burnCard(a){a.pop()}function printCardDeck(a){for(var b=0;b<a.length;b++);}function isGameOver(a){return 0==a.playerList.length||1==a.playerList.length}var CardSuite;!function(a){a[a.c=0]="c",a[a.d=1]="d",a[a.h=2]="h",a[a.s=3]="s"}(CardSuite||(CardSuite={}));var winningScoreAndCards=function(){function a(){}return a}(),Card=function(){function a(a,b){this.cardNumber=a,this.cardType=b}return a}(),PlayerState;!function(a){a[a.Check=0]="Check",a[a.Call=1]="Call",a[a.Raise=2]="Raise",a[a.Fold=3]="Fold",a[a.Init=4]="Init",a[a.AllIn=5]="AllIn",a[a.Small=6]="Small",a[a.Big=7]="Big"}(PlayerState||(PlayerState={}));var Player=function(){function a(a,b){this.currentBet=0,this.id=a,this.name=b,this.state=PlayerState.Init,this.cards=[],this.chipsInPocket=300,this.currentBet=0,this.winningCards=[],this.winningCategory=""}return a.prototype.convertPlayerCardArrayToString=function(){for(var a="",b=0;b<this.cards.length;b++)a=a+this.cards[b].cardNumber+CardSuite[this.cards[b].cardType]+" ";return a},a}(),Pot=function(){function a(){this.currentPotBetAmount=0,this.totalAmount=0,this.hands=["4 of a Kind","Straight Flush","Straight","Flush","High Card","1 Pair","2 Pair","Royal Flush","3 of a Kind","Full House","-Invalid-"],this.handRanks=[8,9,5,6,1,2,3,10,4,7,0],this.playersInvolved=[],this.playersContributions=[]}return a.prototype.addAmountToPot=function(a){this.totalAmount=this.totalAmount+a},a.prototype.subtractAmountFromThePot=function(a){this.totalAmount=this.totalAmount-a},a.prototype.addPlayerToThePot=function(a){this.playersInvolved.push(a),this.playersContributions.push(0)},a.prototype.addAllPlayersToThePot=function(a){for(var b=0;b<a.length;b++)this.playersInvolved.push(a[b]),this.playersContributions.push(0)},a.prototype.addContribution=function(a,b){for(var c=0;c<this.playersInvolved.length;c++)this.playersInvolved[c]==a&&(this.playersContributions[c]+=b)},a.prototype.subtractContribution=function(a,b){for(var c=0;c<this.playersInvolved.length;c++)this.playersInvolved[c]==a&&(this.playersContributions[c]-=b)},a.prototype.checkContribution=function(a){for(var b=0;b<this.playersInvolved.length;b++)if(this.playersInvolved[b]==a)return this.playersContributions[b]},a.prototype.removeIfPlayerPresent=function(a){for(var b=0;b<this.playersInvolved.length;b++)this.playersInvolved[b]==a&&(this.playersInvolved.splice(b,1),this.playersContributions.splice(b,1))},a.prototype.getWinners=function(a){for(var b,c,d=a.convertTableCardArrayToString(),e=-1,f=[],g=0;g<this.playersInvolved.length;g++){var h=this.playersInvolved[g].convertPlayerCardArrayToString()+d;c=gameLogic.rankHand(h);var i=this.handRanks[c.index];i>e?(e=i,f=[],f.push(this.playersInvolved[g]),b=[],b.push(c.wci)):i==e&&(f.push(this.playersInvolved[g]),b.push(c.wci)),this.playersInvolved[g].winningCards=this.getCurrentplayersBestCards(h,c),this.playersInvolved[g].winningCategory=this.hands[this.handRanks[i]]}return f.length>1&&(f=gameLogic.resolveEqualHandsConflict(a.openedCards,f,b,this.hands[this.handRanks.indexOf(e)])),f},a.prototype.getCurrentplayersBestCards=function(a,b){var c=[],d=[];a=a.replace(/\s/g,"");for(var e=0;e<a.length;e++){for(var f="";"c"!=a[e]&&"h"!=a[e]&&"s"!=a[e]&&"d"!=a[e];)f+=a[e++];f+=a[e],c.push(f)}for(var e=0;e<b.wci.length;e++){var f=c[e],g="",h=void 0;switch(f=c[b.wci[e]],g=f.substring(0,f.length-1),f.substring(f.length-1,f.length)){case"s":h=CardSuite.s;break;case"d":h=CardSuite.d;break;case"c":h=CardSuite.c;break;case"h":h=CardSuite.h}var i=new Card(g,h);d.push(i)}return d},a}(),TableSetup=function(){function a(a){this.playerList=[],this.deck=[],this.openedCards=[],this.closedCards=[],this.dealerIndex=a-1,this.currentPlayerIndex=0,this.roundStartIndex=0,this.potArray=[];var b=new Pot;this.potArray.push(b),this.smallBlind=10,this.bigBlind=20,this.currentCallAmount=0,this.winnersOfPreviousHand=[],this.playerIndicesRemovedInThisHand=[]}return a.prototype.addPlayerToTheTable=function(a){this.playerList.push(a)},a.prototype.incrementCurrentPlayerIndex=function(a){for(;;){if(this.currentPlayerIndex++,this.currentPlayerIndex%=this.playerList.length,this.currentPlayerIndex==this.roundStartIndex&&this.playerList[this.currentPlayerIndex].state!=PlayerState.Init)return void gameLogic.roundOver(this,a);if(this.playerList[this.currentPlayerIndex].state!=PlayerState.Fold&&this.playerList[this.currentPlayerIndex].state!=PlayerState.AllIn)return}},a.prototype.incrementCurrentAndRoundStartIndices=function(){this.currentPlayerIndex++,this.currentPlayerIndex%=this.playerList.length,this.roundStartIndex++,this.roundStartIndex%=this.playerList.length},a.prototype.getCurrentPotIndex=function(){return this.potArray.length-1},a.prototype.addNewPot=function(a,b){var c=new Pot;c.addAmountToPot(a),c.addAllPlayersToThePot(b),this.potArray.push(c)},a.prototype.getCumulativePotAmount=function(){for(var a=0,b=0;b<this.potArray.length;b++)a+=this.potArray[b].totalAmount;return a},a.prototype.verifyAndAdjustPots=function(){for(var a=this.potArray[this.potArray.length-1],b=0;b<a.playersInvolved.length;b++);},a.prototype.awardWinners=function(a){for(var b=0;b<this.potArray.length;b++){console.log("\n\nPot Number: "+b);var c=this.potArray[b].getWinners(this);console.log("Final Winning Players:"),console.log(c),this.winnersOfPreviousHand.push(c);for(var d=c.length,e=this.potArray[b].totalAmount/d,f=0;f<c.length;f++)c[f].chipsInPocket+=e}a.playersAfterHandOver=angular.copy(this.playerList),a.winnersList=angular.copy(this.winnersOfPreviousHand)},a.prototype.resetRound=function(a){for(var b=0;b<this.playerList.length;b++)this.playerList[b].currentBet=0,this.playerList[b].state!==PlayerState.Fold&&this.playerList[b].state!==PlayerState.AllIn&&(this.playerList[b].state=PlayerState.Init);for(this.currentPlayerIndex=(this.dealerIndex+1)%this.playerList.length;;){if(this.roundStartIndex=this.currentPlayerIndex,this.currentCallAmount=0,this.currentPlayerIndex==this.dealerIndex&&(this.playerList[this.currentPlayerIndex].state==PlayerState.Fold||this.playerList[this.currentPlayerIndex].state==PlayerState.AllIn))return void gameLogic.roundOver(this,a);if(this.playerList[this.currentPlayerIndex].state!=PlayerState.Fold&&this.playerList[this.currentPlayerIndex].state!=PlayerState.AllIn)break;this.currentPlayerIndex=(this.currentPlayerIndex+1)%this.playerList.length}},a.prototype.resetHand=function(){for(var a=0,b=0;b<this.playerIndicesRemovedInThisHand.length;b++)this.playerIndicesRemovedInThisHand[b]<=this.dealerIndex&&a++;var c=this.dealerIndex-a;0>c?this.dealerIndex=c+this.playerList.length:this.dealerIndex=c,this.dealerIndex=(this.dealerIndex+1)%this.playerList.length,this.roundStartIndex=(this.dealerIndex+1)%this.playerList.length,this.currentPlayerIndex=this.roundStartIndex,this.currentCallAmount=0,this.potArray=[];var d=new Pot;d.addAllPlayersToThePot(this.playerList),this.potArray.push(d),this.openedCards=[],this.closedCards=[];for(var b=0;b<this.playerList.length;b++)this.playerList[b].currentBet=0,this.playerList[b].cards=[],this.playerList[b].state=PlayerState.Init;this.deck=initializeTableDeck(),distributeCards(this)},a.prototype.removePlayersWithInsufficientChips=function(){for(var a=0;a<this.playerList.length;a++)this.playerList[a].chipsInPocket<this.bigBlind&&this.playerIndicesRemovedInThisHand.push(a);for(var a=0;a<this.playerList.length;a++)this.playerList[a].chipsInPocket<this.bigBlind&&(this.playerList.splice(a,1),a--)},a.prototype.getActivePlayersCount=function(){for(var a=0,b=0;b<this.playerList.length;b++)a++;return a},a.prototype.convertTableCardArrayToString=function(){for(var a="",b=0;b<this.openedCards.length;b++)a=a+this.openedCards[b].cardNumber+CardSuite[this.openedCards[b].cardType]+" ";return a.substring(0,a.length-1)},a}(),gameLogic;!function(a){function b(a){for(var b=new TableSetup(a.length),c=0;c<a.length;c++)b.addPlayerToTheTable(new Player(a[c].playerId,a[c].displayName));return b.potArray[b.getCurrentPotIndex()].addAllPlayersToThePot(b.playerList),b.deck=initializeTableDeck(),distributeCards(b),b}function c(a){return{table:b(a),delta:null,winnersList:[],playersAfterHandOver:[]}}function d(a,b,d,f){var g={table:null,delta:null,winnersList:[],playersAfterHandOver:[]};if(g.winnersList=[],g.playersAfterHandOver=[],!a){var h=[],i={displayName:"Adit",playerId:"A",avatarImageUrl:null},j={displayName:"Ridhiman",playerId:"R",avatarImageUrl:null};h.push(i),h.push(j),a=c(h)}var k=!1,l=!1,m=a.table;if(isGameOver(m))throw new Error("Can only make a move if the game is not over! Number of required payers for the game not satisfied");var n=angular.copy(m);n.winnersOfPreviousHand=[],b=n.playerList[n.currentPlayerIndex];switch(0==n.openedCards.length&&(n.currentPlayerIndex==(n.dealerIndex+1)%n.playerList.length&&b.state==PlayerState.Init?(n.potArray[n.getCurrentPotIndex()].addAmountToPot(n.smallBlind),b.chipsInPocket-=n.smallBlind,b.currentBet=n.smallBlind,n.currentCallAmount=n.smallBlind,n.potArray[n.getCurrentPotIndex()].addContribution(b,n.smallBlind),n.potArray[n.getCurrentPotIndex()].currentPotBetAmount=n.smallBlind):n.currentPlayerIndex==(n.dealerIndex+2)%n.playerList.length&&b.state==PlayerState.Init&&(n.potArray[n.getCurrentPotIndex()].addAmountToPot(n.bigBlind),b.chipsInPocket-=n.bigBlind,b.currentBet=n.bigBlind,n.currentCallAmount=n.bigBlind,n.potArray[n.getCurrentPotIndex()].addContribution(b,n.bigBlind),n.potArray[n.getCurrentPotIndex()].currentPotBetAmount=n.bigBlind)),b.state){case PlayerState.Fold:for(var o=0,p=void 0,q=0;q<n.playerList.length;q++)n.playerList[q].state==PlayerState.Fold?o++:p=n.playerList[q];for(var q=0;q<n.potArray.length;q++)n.potArray[q].removeIfPlayerPresent(b);if(o==n.playerList.length-1){var r={delta:null,table:null,winnersList:null,playersAfterHandOver:null};n.awardWinners(r),r.playersAfterHandOver=null,n.removePlayersWithInsufficientChips(),n.resetHand(),l=!0,k=!0,0!=n.playerList.length&&1!=n.playerList.length||console.log("Game Over! Bye Bye! "+n.playerList.length+" Players left!");var s=n.currentPlayerIndex,t={currentPlayer:b,amountAdded:d};r.delta=t,r.table=n;var u;return u=null,{endMatchScores:u,turnIndexAfterMove:s,stateAfterMove:r}}break;case PlayerState.AllIn:if(0==b.chipsInPocket){var v,w=n.currentPlayerIndex,x={currentPlayer:b,amountAdded:d},r={delta:x,table:n,winnersList:[],playersAfterHandOver:n.playerList};return v=null,{endMatchScores:v,turnIndexAfterMove:w,stateAfterMove:r}}var y=b.currentBet+b.chipsInPocket;if(y>=n.currentCallAmount){for(var z=b.chipsInPocket,q=0;q<n.potArray.length;q++){var A=n.potArray[q].checkContribution(b);if(A<n.potArray[q].currentPotBetAmount){var B=n.potArray[q].currentPotBetAmount-A;z-=B,n.potArray[q].addAmountToPot(B),n.potArray[q].addContribution(b,B)}}n.potArray[n.getCurrentPotIndex()].addAmountToPot(z),n.potArray[n.getCurrentPotIndex()].addContribution(b,z),b.chipsInPocket=0,b.currentBet=y,y>n.currentCallAmount&&(n.roundStartIndex=n.currentPlayerIndex),n.currentCallAmount=y,n.potArray[n.getCurrentPotIndex()].currentPotBetAmount+=z}else if(y<n.currentCallAmount){for(var C=0,D=0,E=y+n.potArray[D].playersContributions[f],F=void 0,q=0;q<n.potArray.length;q++){if(C+=n.potArray[q].currentPotBetAmount,y==C){n.potArray[q].addAmountToPot(b.chipsInPocket),n.potArray[q].addContribution(b,b.chipsInPocket),b.chipsInPocket=0,b.currentBet=y;for(var G=q+1;G<n.potArray.length;G++)n.potArray[G].removeIfPlayerPresent(b);F=1;break}if(C>y){F=2,D=q;break}}if(1==F)break;for(var z=b.chipsInPocket,q=0;D>q;q++){var A=n.potArray[q].checkContribution(b);if(A<n.potArray[q].currentPotBetAmount){var H=n.potArray[q].currentPotBetAmount-A;z-=H,n.potArray[q].addAmountToPot(H),n.potArray[q].addContribution(b,H)}}for(var I=new Pot,J=[],q=0;q<n.potArray[D].playersInvolved.length;q++)n.potArray[D].playersInvolved[q]!=b&&J.push(n.potArray[D].playersInvolved[q]);I.addAllPlayersToThePot(J);for(var K=n.potArray[D].playersInvolved,L=n.potArray[D].playersContributions,M=0,q=0;q<L.length;q++)L[q]>M&&(M=L[q]);I.currentPotBetAmount=M-E;for(var B=0,N=0,O=[],P=[],q=0;q<K.length;q++)L[q]>E&&(B=L[q]-E,n.potArray[D].subtractContribution(K[q],B),N+=B,O.push(K[q]),P.push(B));n.potArray[D].addAmountToPot(z),n.potArray[D].addContribution(b,z),n.potArray[D].currentPotBetAmount=E,n.potArray[D].subtractAmountFromThePot(N),I.addAmountToPot(N);for(var q=0;q<O.length;q++)I.addContribution(O[q],P[q]);n.potArray.splice(D+1,0,I),b.chipsInPocket=0,b.currentBet=y}break;case PlayerState.Check:if(n.currentCallAmount>b.currentBet)throw new Error("Can't check. The player has not matched the current table bet amount");break;case PlayerState.Call:var Q=n.currentCallAmount-b.currentBet;if(0==Q)throw new Error("The player has already matched the current table bet amount");if(Q>b.chipsInPocket)throw new Error("The player doesn't have enough chips to match the current table bet amount. He can go All In");for(var q=0;q<n.potArray.length;q++){var A=n.potArray[q].checkContribution(b);if(A<n.potArray[q].currentPotBetAmount){var B=n.potArray[q].currentPotBetAmount-A;n.potArray[q].addAmountToPot(B),n.potArray[q].addContribution(b,B)}}b.chipsInPocket-=Q,b.currentBet=n.currentCallAmount,0==b.chipsInPocket&&(b.state=PlayerState.AllIn);break;case PlayerState.Raise:var Q=n.currentCallAmount-b.currentBet,R=d,S=Q+R;if(S>b.chipsInPocket)throw new Error("The player doesn't have enough chips to raise the bet. Choose a smaller amount.");for(var z=S,q=0;q<n.potArray.length;q++){var A=n.potArray[q].checkContribution(b);if(A<n.potArray[q].currentPotBetAmount){var B=n.potArray[q].currentPotBetAmount-A;z-=B,n.potArray[q].addAmountToPot(B),n.potArray[q].addContribution(b,B)}}n.potArray[n.getCurrentPotIndex()].addAmountToPot(z),n.potArray[n.getCurrentPotIndex()].addContribution(b,z),b.chipsInPocket-=S,b.currentBet=b.currentBet+S,n.currentCallAmount=b.currentBet,n.roundStartIndex=n.currentPlayerIndex,n.potArray[n.getCurrentPotIndex()].currentPotBetAmount+=z,0==b.chipsInPocket&&(b.state=PlayerState.AllIn)}var T,U=isGameOver(n);(n.currentPlayerIndex+1)%n.playerList.length==n.roundStartIndex&&b.state!=PlayerState.Init&&(5==n.openedCards.length&&(l=!0),e(n,g),T=n.currentPlayerIndex,k=!0),U?T=-1:(0!=n.openedCards.length||0!=l||b.state!=PlayerState.Init||n.currentPlayerIndex!=(n.dealerIndex+1)%n.playerList.length&&n.currentPlayerIndex!=(n.dealerIndex+2)%n.playerList.length?0==k&&(n.incrementCurrentPlayerIndex(g),T=n.currentPlayerIndex):(n.incrementCurrentAndRoundStartIndices(),T=n.currentPlayerIndex),T=n.currentPlayerIndex);var V={currentPlayer:b,amountAdded:d};g.delta=V,g.table=n;var W;return W=null,{endMatchScores:W,turnIndexAfterMove:T,stateAfterMove:g}}function e(a,b){switch(f(a),a.openedCards.length){case 0:for(var c=0;3>c;c++)a.openedCards.push(a.closedCards.pop());console.log("\n1st Round Over! 3 Cards Open"),a.verifyAndAdjustPots(),a.resetRound(b);break;case 3:a.openedCards.push(a.closedCards.pop()),console.log("\n2nd Round Over! 1 Card Open"),a.resetRound(b);break;case 4:a.openedCards.push(a.closedCards.pop()),console.log("\n3rd Round Over! 1 Card Open"),a.resetRound(b);break;case 5:console.log("\nHand Over"),a.awardWinners(b),a.removePlayersWithInsufficientChips(),a.resetHand(),0!=a.playerList.length&&1!=a.playerList.length||console.log("Game Over! Bye Bye! "+a.playerList.length+" Players left!")}}function f(a){for(var b=a.potArray.length-1;b<a.potArray.length;b++){var c=a.potArray[b],d=c.playersContributions[0],e=[];e.push(c.playersInvolved[0]);for(var f=0;f<c.playersInvolved.length;f++)c.playersInvolved[f].state==PlayerState.AllIn&&c.playersContributions[f]<c.currentPotBetAmount&&(c.playersContributions[f]<d?(d=c.playersContributions[f],e=[],e.push(c.playersInvolved[f])):c.playersContributions[f]==d&&e.push(c.playersInvolved[f]));if(d<c.currentPotBetAmount){for(var g=new Pot,h=[],f=0;f<c.playersInvolved.length;f++){for(var i=!1,j=0;j<e.length;j++)if(c.playersInvolved[f]==e[j]){i=!0;break}0==i&&h.push(c.playersInvolved[f])}var k=d;g.addAllPlayersToThePot(h),g.currentPotBetAmount=c.currentPotBetAmount-k;for(var l=c.playersInvolved,m=c.playersContributions,n=0,o=0,p=[],q=[],f=0;f<l.length;f++)m[f]>k&&(n=m[f]-k,c.subtractContribution(l[f],n),o+=n,p.push(l[f]),q.push(n));c.currentPotBetAmount=k,c.subtractAmountFromThePot(o),g.addAmountToPot(o);for(var f=0;f<p.length;f++)g.addContribution(p[f],q[f]);a.potArray.push(g)}}}function g(a){}function h(a){return 0==a.getCumulativePotAmount()}function i(a){return a.getCumulativePotAmount()==a.smallBlind}function j(a){return!h(a)&&!i(a)}function k(a,b){return null==b?!1:h(a)||i(a)?!1:!(a.currentCallAmount>b.currentBet)}function l(a,b){if(null==b)return!1;var c=a.currentCallAmount-b.currentBet;return h(a)||i(a)?!1:0==c?!1:!(c>b.chipsInPocket)}function m(a,b,c){if(null==b)return!1;var d=a.currentCallAmount-b.currentBet,e=c,f=d+e;return h(a)||i(a)?!1:!(f>b.chipsInPocket)}function n(a,b){return null==b?!1:!h(a)&&!i(a)}function o(a){var b,c=[8,9,5,6,1,2,3,10,4,7,0],d=10,e=[],f=a.replace(/A/g,"14").replace(/K/g,"13").replace(/Q/g,"12").replace(/J/g,"11").replace(/s|c|h|d/g,","),g=f.replace(/\s/g,"").slice(0,-1).split(",").map(Number).filter(Boolean),h=a.match(/s|c|h|d/g),i=[];for(b=0;b<h.length;b++)"s"===h[b]?i[b]=1:"c"===h[b]?i[b]=8:"h"===h[b]?i[b]=32:"d"===h[b]&&(i[b]=64);if(null!==g&&null!=i){if(g.length==i.length){var j=void 0,k={},l=0,m=void 0;for(b=0;b<g.length;b++)j=g[b]+h[b],k[j]=1;for(m in k)k.hasOwnProperty(m)&&l++;if(g.length>=5&&g.length==i.length&&g.length==l){var n=q(5,g.length),o=0,s=10;for(b=0;b<n.length;b++){var t=[g[n[b][0]],g[n[b][1]],g[n[b][2]],g[n[b][3]],g[n[b][4]]],u=[i[n[b][0]],i[n[b][1]],i[n[b][2]],i[n[b][3]],i[n[b][4]]];if(d=r(t,u),c[d]>o)o=c[d],s=d,e=n[b].slice();else if(c[d]==o){var v=p(t),w=p([g[e[0]],g[e[1]],g[e[2]],g[e[3]],g[e[4]]]);v>w&&(e=n[b].slice())}}d=s}}var x=new winningScoreAndCards;return x.index=d,x.wci=e,x}}function p(a){var b,c=a.slice(),d=[];for(b=0;5>b;b++)d[c[b]]=d[c[b]]>=1?d[c[b]]+1:1;return c.sort(function(a,b){return d[a]<d[b]?1:d[a]>d[b]?-1:b-a}),c[0]<<16|c[1]<<12|c[2]<<8|c[3]<<4|c[4]}function q(a,b){function c(a,b,c){var d;if(0===a.length){for(d=0;b>d;++d)a[d]=d;return!0}for(d=b-1,++a[d];d>0&&a[d]>=c-b+1+d;)--d,++a[d];if(a[0]>c-b)return!1;for(d+=1;b>d;++d)a[d]=a[d-1]+1;return!0}for(var d=[],e=[];c(e,a,b);)d.push(e.slice());return d}function r(a,b){var c,d,e,f;for(d=-1,c=e=0;5>d;d++,e=Math.pow(2,4*a[d]))c+=e*((c/e&15)+1);return 5!=(c%=15)?c-1:(f=1<<a[0]|1<<a[1]|1<<a[2]|1<<a[3]|1<<a[4],c-=f/(f&-f)==31||16444==f?3:1,b[0]==(b[0]|b[1]|b[2]|b[3]|b[4])?c-(31744==f?-5:1):c)}function s(a,b,c,d){for(var e=[],f=[],g=0;g<b.length;g++){e[g]=[];for(var h=0;h<c[g].length;h++)c[g][h]<2?e[g].push(b[g].cards[c[g][h]]):e[g].push(a[c[g][h]-2])}switch(d){case"4 of a Kind":return t(a,b,c,d,e,f);case"3 of a Kind":return u(a,b,c,d,e,f);case"1 Pair":return v(a,b,c,d,e,f);case"Straight Flush":return w(a,b,c,d,e,f);case"Straight":return w(a,b,c,d,e,f);case"Flush":return x(a,b,c,d,e,f);case"High Card":return x(a,b,c,d,e,f);case"Full House":return u(a,b,c,d,e,f);case"Royal Flush":return b;case"2 Pair":return y(a,b,c,d,e,f);case"-Invalid-":return}}function t(a,b,c,d,e,f){for(var g=0,h=0,i=0;i<b.length;i++){for(var j=1,k=0,l="",m=0;m<e[i].length-1;m++){for(var n=m+1;n<e[i].length;n++)e[i][m].cardNumber==e[i][n].cardNumber&&j++;if(l=e[i][m].cardNumber,4==j)break;j=1}j=0;for(var m=0;m<e[i].length;m++){j=1;for(var n=0;n<e[i].length;n++)e[i][m].cardNumber==e[i][n].cardNumber&&m!=n&&j++;1==j&&z(e[i][m].cardNumber)>k&&(k=z(e[i][m].cardNumber))}var o=z(l);o>g?(g=o,h=k,f=[],f.push(b[i])):o==g&&k>h?(h=k,f=[],f.push(b[i])):o==g&&k==h&&f.push(b[i])}return f}function u(a,b,c,d,e,f){for(var g=0,h=0,i=0,j=0;j<b.length;j++){for(var k=1,l=0,m=0,n="",o=0;o<e[j].length-1;o++){for(var p=o+1;p<e[j].length;p++)e[j][o].cardNumber==e[j][p].cardNumber&&k++;if(n=e[j][o].cardNumber,3==k)break;k=1}k=0;for(var o=0;o<e[j].length;o++){k=1;for(var p=0;p<e[j].length;p++)e[j][o].cardNumber==e[j][p].cardNumber&&o!=p&&k++;3!=k&&z(e[j][o].cardNumber)>l?(m=l,l=z(e[j][o].cardNumber)):3!=k&&z(e[j][o].cardNumber)>l&&(m=z(e[j][o].cardNumber))}var q=z(n);q>g?(g=q,i=l,m=l,f=[],f.push(b[j])):q==g&&l>i?(i=l,h=m,f=[],f.push(b[j])):q==g&&l==i&&m>h?(h=m,f=[],f.push(b[j])):q==g&&l==i&&m==h&&f.push(b[j])}return f}function v(a,b,c,d,e,f){for(var g=0,h=0,i=0,j=0,k=0;k<b.length;k++){for(var l=1,m="",n=0;n<e[k].length-1;n++){for(var o=n+1;o<e[k].length;o++)e[k][n].cardNumber==e[k][o].cardNumber&&l++;if(m=e[k][n].cardNumber,2==l)break;l=1}for(var p=0,q=0,r=0,s=z(m),n=0;n<e[k].length;n++){var t=z(e[k][n].cardNumber);t!=s&&(t>p?(r=q,q=p,p=t):t>q?(r=q,q=t):t>r&&(r=t))}s>g?(g=s,h=p,i=q,j=r,f=[],f.push(b[k])):s==g&&p>h?(h=p,i=q,j=r,f=[],f.push(b[k])):s==g&&p==h&&q>i?(i=q,j=r,f=[],f.push(b[k])):s==g&&p==h&&q==i&&r>j?(j=r,f=[],f.push(b[k])):s==g&&p==h&&q==i&&r==j&&f.push(b[k])}return f}function w(a,b,c,d,e,f){for(var g=0,h=0;h<b.length;h++){for(var i=0,j=0;j<e[h].length;j++){var k=z(e[h][j].cardNumber);k>i&&(i=k)}i>g?(g=i,f=[],f.push(b[h])):i==g&&f.push(b[h])}return f}function x(a,b,c,d,e,f){for(var g=[],h=0;h<e.length;h++)e[h].sort(A);for(var h=0;5>h;h++){for(var i=0,j=0;j<b.length;j++)z(e[j][h].cardNumber)>i?(i=z(e[j][h].cardNumber),f=[],f.push(b[j]),g=[],g.push(e[j])):z(e[j][h].cardNumber)==i&&(f.push(b[j]),g.push(e[j]));if(1==f.length||4==h)return f;b=f,e=g,f=[]}return f}function y(a,b,c,d,e,f){for(var g=0,h=0,i=0,j=0;j<b.length;j++){for(var k=1,l=0,m=0,n=0,o=0;o<e[j].length-1;o++){for(var p=o+1;p<e[j].length;p++)e[j][o].cardNumber==e[j][p].cardNumber&&k++;if(2==k){var q=z(e[j][o].cardNumber);q>l?(m=l,l=q):q>m&&(m=q)}else k=1}k=1;for(var o=0;o<e[j].length;o++){k=1;for(var p=0;p<e[j].length;p++)e[j][o].cardNumber==e[j][p].cardNumber&&o!=p&&k++;if(1==k){n=z(e[j][o].cardNumber);break}}l>g?(g=l,h=m,i=n,f=[],f.push(b[j])):l==g&&m>h?(h=m,i=n,f=[],f.push(b[j])):l==g&&m==h&&n>i?(i=n,f=[],f.push(b[j])):l==g&&m==h&&n==i&&f.push(b[j])}return f}function z(a){switch(a){case"J":return 11;case"Q":return 12;case"K":return 13;case"A":return 14;default:return Number(a)}}function A(a,b){return z(a.cardNumber)>z(b.cardNumber)?-1:z(a.cardNumber)<z(b.cardNumber)?1:0}function B(){var b=a.createMove(null,null,0,0);b=a.createMove(b.stateAfterMove,null,0,b.turnIndexAfterMove),b.stateAfterMove.table.playerList[0].state=PlayerState.Call,b=a.createMove(b.stateAfterMove,null,0,b.turnIndexAfterMove),b.stateAfterMove.table.playerList[1].state=PlayerState.Check,b=a.createMove(b.stateAfterMove,null,0,b.turnIndexAfterMove),b.stateAfterMove.table.playerList[0].state=PlayerState.Check,b=a.createMove(b.stateAfterMove,null,0,b.turnIndexAfterMove),b.stateAfterMove.table.playerList[1].state=PlayerState.Check,b=a.createMove(b.stateAfterMove,null,0,b.turnIndexAfterMove),b.stateAfterMove.table.playerList[0].state=PlayerState.Check,b=a.createMove(b.stateAfterMove,null,0,b.turnIndexAfterMove),b.stateAfterMove.table.playerList[1].state=PlayerState.Check,b=a.createMove(b.stateAfterMove,null,0,b.turnIndexAfterMove),b.stateAfterMove.table.playerList[0].state=PlayerState.Check,b=a.createMove(b.stateAfterMove,null,0,b.turnIndexAfterMove),b.stateAfterMove.table.playerList[1].state=PlayerState.Check,b=a.createMove(b.stateAfterMove,null,0,b.turnIndexAfterMove),console.log(b.stateAfterMove)}a.getInitialTable=b,a.getInitialState=c,a.createMove=d,a.roundOver=e,a.adjustPots=f,a.checkMoveOk=g,a.canSmallBlindOrNot=h,a.canBigBlindOrNot=i,a.canFoldOrNot=j,a.canCheckOrNot=k,a.canCallOrNot=l,a.canRaiseOrNot=m,a.canAllInOrNot=n,a.rankHand=o,a.getPokerScore=p,a.getCombinations=q,a.resolveEqualHandsConflict=s,a.resolve_4_OfAKind=t,a.resolve_3_OfAKind=u,a.resolve_2_OfAKind=v,a.findHighestCard=w,a.resolveHighestCard=x,a.resolve2Pairs=y,a.getCardIntegerValue=z,a.sortNumber=A,a.forSimpleTestHtml=B}(gameLogic||(gameLogic={}));var game;!function(a){function b(){translate.setTranslations(c()),translate.setLanguage("en"),log.log("Translation of 'RULES_OF_TICTACTOE' is "+translate("RULES_OF_TICTACTOE")),resizeGameAreaService.setWidthToHeight(1),moveService.setGame({minNumberOfPlayers:2,maxNumberOfPlayers:2,checkMoveOk:gameLogic.checkMoveOk,updateUI:f}),document.addEventListener("animationend",d,!1),document.addEventListener("webkitAnimationEnd",d,!1),document.addEventListener("oanimationend",d,!1),setTimeout(d,1e3);var a=window;a.HTMLInspector&&setInterval(function(){a.HTMLInspector.inspect({excludeRules:["unused-classes","script-placement"]})},3e3)}function c(){return{RULES_OF_TICTACTOE:{en:"Rules of Poker",iw:"חוקי המשחק"},RULES_SLIDE1:{en:"You and your opponent take turns to mark the grid in an empty spot. The first mark is X, then O, then X, then O, etc.",iw:"אתה והיריב מסמנים איקס או עיגול כל תור"},RULES_SLIDE2:{en:"The first to mark a whole row, column or diagonal wins.",iw:"הראשון שמסמן שורה, עמודה או אלכסון מנצח"},CLOSE:{en:"Close",iw:"סגור"}}}function d(){a.animationEnded||$rootScope.$apply(function(){log.info("Animation ended"),a.animationEnded=!0,e()})}function e(){!a.isComputerTurn}function f(b){if(log.info("Game got updateUI:",b),a.animationEnded=!1,a.move=b.move,a.state=a.move.stateAfterMove,a.state){for(var c=new TableSetup(b.playersInfo.length),d=[],f=[],g=[],h=0;h<b.move.stateAfterMove.table.playerList.length;h++){var i=new Player(b.move.stateAfterMove.table.playerList[h].id,b.move.stateAfterMove.table.playerList[h].name);i.state=b.move.stateAfterMove.table.playerList[h].state,i.chipsInPocket=b.move.stateAfterMove.table.playerList[h].chipsInPocket,i.currentBet=b.move.stateAfterMove.table.playerList[h].currentBet,i.cards=b.move.stateAfterMove.table.playerList[h].cards,i.winningCards=b.move.stateAfterMove.table.playerList[h].winningCards,i.winningCategory=b.move.stateAfterMove.table.playerList[h].winningCategory,d.push(i)}for(var h=0;h<b.move.stateAfterMove.table.potArray.length;h++){var j=new Pot;j.hands=b.move.stateAfterMove.table.potArray[h].hands,j.handRanks=b.move.stateAfterMove.table.potArray[h].handRanks,j.currentPotBetAmount=b.move.stateAfterMove.table.potArray[h].currentPotBetAmount,j.totalAmount=b.move.stateAfterMove.table.potArray[h].totalAmount;for(var l=[],m=0;m<b.move.stateAfterMove.table.potArray[h].playersInvolved.length;m++)for(var n=0;n<d.length;n++)if(b.move.stateAfterMove.table.potArray[h].playersInvolved[m].id==d[n].id){l.push(d[n]);break}j.playersInvolved=l,j.playersContributions=b.move.stateAfterMove.table.potArray[h].playersContributions,f.push(j)}for(var h=0;h<b.move.stateAfterMove.table.winnersOfPreviousHand.length;h++){for(var o=[],m=0;m<b.move.stateAfterMove.table.winnersOfPreviousHand[h].length;m++)for(var n=0;n<d.length;n++)if(b.move.stateAfterMove.table.winnersOfPreviousHand[h][m].id==d[n].id){o.push(d[n]);break}g.push(o)}c.playerList=d,c.deck=b.move.stateAfterMove.table.deck,c.openedCards=b.move.stateAfterMove.table.openedCards,c.closedCards=b.move.stateAfterMove.table.closedCards,c.dealerIndex=b.move.stateAfterMove.table.dealerIndex,c.currentPlayerIndex=b.move.stateAfterMove.table.currentPlayerIndex,c.roundStartIndex=b.move.stateAfterMove.table.roundStartIndex,c.potArray=f,c.smallBlind=b.move.stateAfterMove.table.smallBlind,c.bigBlind=b.move.stateAfterMove.table.bigBlind,c.currentCallAmount=b.move.stateAfterMove.table.currentCallAmount,c.playerIndicesRemovedInThisHand=b.move.stateAfterMove.table.playerIndicesRemovedInThisHand,c.winnersOfPreviousHand=g,b.move.stateAfterMove.table=c;for(var n=0;n<d.length;n++)if(d[n].id==b.move.stateAfterMove.delta.currentPlayer.id){b.move.stateAfterMove.delta.currentPlayer=d[n];break}for(var p=[],h=0;h<b.move.stateAfterMove.winnersList.length;h++){for(var q=[],m=0;m<b.move.stateAfterMove.winnersList[h].length;m++)for(var n=0;n<d.length;n++)if(b.move.stateAfterMove.winnersList[h][m].id==d[n].id){q.push(d[n]);break}p.push(q)}b.move.stateAfterMove.winnersList=p;for(var t=[],h=0;h<b.move.stateAfterMove.playersAfterHandOver.length;h++)for(var m=0;m<d.length;m++)if(b.move.stateAfterMove.playersAfterHandOver[h].id==d[m].id){t.push(d[m]);break}b.move.stateAfterMove.playersAfterHandOver=t,a.move=b.move,a.state=a.move.stateAfterMove}else console.log("getInitialState() call. Should happen twice including the fake!"),a.state=gameLogic.getInitialState(b.playersInfo);a.canMakeMove=a.move.turnIndexAfterMove>=0&&b.yourPlayerIndex===a.move.turnIndexAfterMove,console.log("canMakeMove: "+a.canMakeMove+" params.yourPlayerIndex: "+b.yourPlayerIndex+"move.turnIndexAfterMove: "+a.move.turnIndexAfterMove+" \nSTATE:"),console.log(a.state),b.yourPlayerIndex>=0&&3!==a.state.table.playerList[b.yourPlayerIndex].state&&(a.temp_yourPlayerIndex=b.yourPlayerIndex,r=a.state.table.playerList[b.yourPlayerIndex].cards[0],s=a.state.table.playerList[b.yourPlayerIndex].cards[1],a.class_yourPlayerCards_card1=k(r),a.class_yourPlayerCards_card2=k(s)),a.state.winnersList.length<0&&(a.openedCardsList=a.state.table.openedCards),a.isComputerTurn=a.canMakeMove&&""===b.playersInfo[b.yourPlayerIndex].playerId,a.isComputerTurn&&(a.canMakeMove=!1,a.state.delta||e()),console.log("state at end of updateUI",a.state)}function g(b,c){if(log.info("Clicked on button:",b," amountRaised: ",c),"?throwException"===window.location.search)throw new Error("Throwing the error because URL has '?throwException'");if(!a.canMakeMove)return void console.log(" cannot make move, "+a.move.turnIndexAfterMove+" should play");try{console.log("cellClicked STATE BEFORE MAKE MOVE: ",a.state),a.oldOpenCardsSize=a.state.table.openedCards.length,a.state.table.playerList[a.temp_yourPlayerIndex].state=h(b);var d=gameLogic.createMove(a.state,null,c,a.move.turnIndexAfterMove);console.log("cellClicked STATE AFTER MAKE MOVE: "),console.log(d),a.canMakeMove=!1,moveService.makeMove(d)}catch(e){log.info("Illegal Move",b),console.log(e)}}function h(a){switch(a){case"Raise":return PlayerState.Raise;case"Fold":return PlayerState.Fold;case"Call":return PlayerState.Call;case"AllIn":return PlayerState.AllIn;case"Check":return PlayerState.Check;case"Small":return PlayerState.Init;case"Big":return PlayerState.Init;default:throw new Error("getPlayerStateBasedOnAction: Illegal PlayertState")}}function i(b){var c=PlayerState[a.state.table.playerList[b].state];return c}function j(){var b=document.getElementById("raiseAmount").value;""===b&&(b="0"),"0"!=b&&a.cellClicked("Raise",+b)}function k(a){var b="card";return b+=" "+l(a)+" "+m(a)}function l(a){switch(a.cardType){case 0:return"clubs";case 1:return"diamonds";case 2:return"hearts";case 3:return"spades";default:return" "}}function m(a){switch(a.cardNumber){case"K":return"rank13";case"Q":return"rank12";case"J":return"rank11";case"10":return"rank10";case"9":return"rank9";case"8":return"rank8";case"7":return"rank7";case"6":return"rank6";case"5":return"rank5";case"4":return"rank4";case"3":return"rank3";case"2":return"rank2";case"A":return"rank1";default:return" "}}function n(b){switch(b){case"Raise":return gameLogic.canRaiseOrNot(a.state.table,a.state.table.playerList[a.temp_yourPlayerIndex],0);case"Fold":return gameLogic.canFoldOrNot(a.state.table);case"Call":return gameLogic.canCallOrNot(a.state.table,a.state.table.playerList[a.temp_yourPlayerIndex]);case"AllIn":return gameLogic.canAllInOrNot(a.state.table,a.state.table.playerList[a.temp_yourPlayerIndex]);case"Check":return gameLogic.canCheckOrNot(a.state.table,a.state.table.playerList[a.temp_yourPlayerIndex]);case"Small":return gameLogic.canSmallBlindOrNot(a.state.table);case"Big":return gameLogic.canBigBlindOrNot(a.state.table);default:return!0}}function o(a){var b;switch(b=a.cardNumber,a.cardType){case 0:return b+"&clubs;";case 1:
return b+"&diams;";case 2:return b+"&hearts;";case 3:return b+"&spades;";default:return" "}}function p(a){switch(a.cardType){case 0:return"smallCard smallClubs";case 1:return"smallCard smallDiamonds";case 2:return"smallCard smallHearts";case 3:return"smallCard smallSpades";default:return" "}}function q(b){return b.target===b.currentTarget&&(b.preventDefault(),b.stopPropagation(),a.isHelpModalShown=!1),!0}a.animationEnded=!1,a.canMakeMove=!1,a.isComputerTurn=!1,a.move=null,a.state=null,a.isHelpModalShown=!1,a.oldOpenCardsSize=0;var r,s;a.init=b,a.cellClicked=g,a.getPlayerStateBasedOnAction=h,a.getPlayerStateByIndex=i,a.raised=j,a.getCardClass=k,a.getCardSuite=l,a.getCardRank=m,a.shouldShowButton=n,a.getSmallCardDisplayValue=o,a.getSmallCardClass=p,a.clickedOnModal=q}(game||(game={})),angular.module("myApp",["ngTouch","ui.bootstrap","gameServices"]).run(function(){$rootScope.game=game,game.init()}),angular.module("myApp").filter("to_trusted",["$sce",function(a){return function(b){return a.trustAsHtml(b)}}]);
//# sourceMappingURL=everything.min.js.map